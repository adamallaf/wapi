<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WAPI: hostapd Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>hostapd Configuration</h1>  </div>
</div>
<div class="contents">

<p><a href="http://hostap.epitest.fi/hostapd/"><code>hostapd</code>  is the de-facto user space daemon for 802.11 access point and authentication servers. </a> 
<a href="#_details">More...</a></p>
<table class="memberdecls">
</table>
<p><a href="http://hostap.epitest.fi/hostapd/"><code>hostapd</code>  is the de-facto user space daemon for 802.11 access point and authentication servers. </a></p>
<p>It implements IEEE 802.11 access point (AP) management, IEEE 802.1X/WPA/WPA2/EAP Authenticators, RADIUS client, EAP server, and RADIUS authentication server. <code>hostapd</code> is used from embedded commercial systems (Wi-Fi access points, etc.) to commodity desktop computers. Since WAPI is all about providing access to wireless device configurations, one might expect WAPI works with <code>hostapd</code> as well. But, as of time of this writing, this is practically impossible due to technical limitations.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>One would desire to change AP configurations on-the-fly without losing established connections. Despite this scheme is supported by 802.11, it is not currently provided by hostapd. (See <a href="http://lists.shmoo.com/pipermail/hostap/2011-January/022418.html">Changing Channel On-The-Fly</a>.) You are warned.</dd></dl>
<p><code>hostapd</code> is designed as a standalone application and doesn't allow external programs to play with the configurations of wireless device it is currently operating at. On the other hand, the decions (e.g. channel change) made by <code>hostapd</code> generally cannot be observed by external applications. (See <a href="http://lists.shmoo.com/pipermail/hostap/2011-January/022393.html">SIGHUP and iwconfig channel anomaly</a>.) For this purpose, there are two ways to communicate with <code>hostapd</code> to alter wireless device configurations.</p>
<h2><a class="anchor" id="hostapdconffile"></a>
Accessing hostapd Through hostapd.conf</h2>
<p>This is the most straightforward method to communicate with <code>hostapd</code>. Steps are, as expected, trivial:</p>
<ol type="1">
<li>Read configurations from <code>/etc/hostapd/hostapd</code>.conf.</li>
<li>Make necessary changes to the read configurations and write them back.</li>
<li>Send a <code>SIGHUP</code> to <code>hostapd</code> process. (You can use <code>/var/run/hostapd</code>.pid file.)</li>
</ol>
<p>Below is a sample C++ code (see <code>examples/hostapd.cpp</code>) implementing this method.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;fstream&gt;</span>
<span class="preprocessor">#include &lt;string&gt;</span>
<span class="preprocessor">#include &lt;utility&gt;</span>
<span class="preprocessor">#include &lt;map&gt;</span>

<span class="preprocessor">#include &lt;errno.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<span class="preprocessor">#include &lt;signal.h&gt;</span>

<span class="keyword">using namespace </span>std;


<span class="keyword">static</span> pair&lt;string, string&gt;
hostapd_split_conf(<span class="keyword">const</span> <span class="keywordtype">string</span> line)
{
  <span class="keywordtype">size_t</span> eqchar = line.find(<span class="stringliteral">&quot;=&quot;</span>);
  <span class="keywordflow">return</span> make_pair(
    line.substr(0, eqchar),
    line.substr((eqchar+1), line.length())
    );
}


<span class="keyword">static</span> <span class="keywordtype">bool</span>
hostapd_read_conf(<span class="keyword">const</span> <span class="keywordtype">char</span> *conffile, map&lt;string, string&gt;&amp; conf)
{
  ifstream ifs(conffile);
  <span class="keywordflow">if</span> (!ifs)
  {
    fprintf(
      stderr, <span class="stringliteral">&quot;Couldn&#39;t open %s for reading: %s&quot;</span>,
      conffile, strerror(errno));
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
  }

  <span class="keywordtype">string</span> line;
  <span class="keywordflow">while</span> (getline(ifs, line))
  {
    pair&lt;string,string&gt; entry = hostapd_split_conf(line);
    conf[entry.first] = entry.second;
  }

  <span class="keywordflow">return</span> <span class="keyword">true</span>;
}


<span class="keyword">static</span> <span class="keywordtype">bool</span>
hostapd_write_conf(<span class="keyword">const</span> <span class="keywordtype">char</span> *conffile, <span class="keyword">const</span> map&lt;string, string&gt; conf)
{
  ofstream ofs(conffile);
  <span class="keywordflow">if</span> (!ofs)
  {
    fprintf(
      stderr, <span class="stringliteral">&quot;Couldn&#39;t open %s for writing: %s&quot;</span>,
      conffile, strerror(errno));
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
  }
  
  <span class="keywordflow">for</span> (map&lt;string, string&gt;::const_iterator it = conf.begin();
       it != conf.end();
       ++it)
    ofs &lt;&lt; it-&gt;first &lt;&lt; <span class="stringliteral">&quot;=&quot;</span> &lt;&lt; it-&gt;second &lt;&lt; endl;
  <span class="keywordflow">return</span> <span class="keyword">true</span>;
}


<span class="keyword">static</span> <span class="keywordtype">bool</span>
hostapd_reload(<span class="keyword">const</span> <span class="keywordtype">char</span> *pidfile)
{
  ifstream ifs(pidfile);
  <span class="keywordtype">string</span> line;
  <span class="keywordtype">int</span> pid;
  <span class="keywordflow">return</span> (
    getline(ifs, line) &amp;&amp;
    sscanf(line.c_str(), <span class="stringliteral">&quot;%d&quot;</span>, &amp;pid) &amp;&amp;
    !kill(pid, SIGHUP));
}


<span class="keywordtype">int</span>
main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
  <span class="keywordflow">if</span> (argc != 5)
  {
    fprintf(stderr, <span class="stringliteral">&quot;Usage: %s &lt;PIDFILE&gt; &lt;CONFFILE&gt; &lt;VAR&gt; &lt;VAL&gt;\n&quot;</span>, argv[0]);
    <span class="keywordflow">return</span> 1;
  }
  <span class="keyword">const</span> <span class="keywordtype">char</span> *pidfile = argv[1];
  <span class="keyword">const</span> <span class="keywordtype">char</span> *conffile = argv[2];
  <span class="keyword">const</span> <span class="keywordtype">string</span> var = string(argv[3]);
  <span class="keyword">const</span> <span class="keywordtype">string</span> val = string(argv[4]);

  map&lt;string, string&gt; conf;
  hostapd_read_conf(conffile, conf);
  conf[var] = val;
  hostapd_write_conf(conffile, conf);
  hostapd_reload(pidfile);

  <span class="keywordflow">return</span> 0;
}
</pre></div><h2><a class="anchor" id="hostapdwpactrl"></a>
Accessing hostapd Through Control Interface</h2>
<p><code>hostapd</code> provides a <a href="http://hostap.epitest.fi/wpa_supplicant/devel/hostapd_ctrl_iface_page.html">control interface</a> that can be used by external programs to control the operations of the hostapd daemon and to get status information and event notifications. There is a small C library, in a form of a single C file, <code>wpa_ctrl.c</code>, that provides helper functions to facilitate the use of the control interface. External programs can link this file into them and then use the library functions documented in <code>wpa_ctrl.h</code> to interact with <code>hostapd</code>.</p>
<p>However, as of time of this writing, <code>hostapd</code> control interface commands lack documentation and are not that easy to implement compared to the straightforward approach given above. At the moment neither us, nor <code>hostapd</code> guys provide any entrance level examples regarding this control interface. You might want to check out <a href="http://hostap.epitest.fi/wpa_supplicant/devel/hostapd__cli_8c.html">hostapd_cli.c</a> in the <code>hostapd</code> sources. </p>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Jan 24 2011 18:05:41 for WAPI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
